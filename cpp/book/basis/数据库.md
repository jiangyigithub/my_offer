作者：皮皮关
链接：https://www.zhihu.com/question/24088008/answer/1085284178
来源：知乎
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

本想从原理上讲讲，但这个问题很简单又很本质，直接针对性举例可能效果更好。考虑一个很常规的问题：一个中学的全体学生信息库。如果用文件系统制作学生信息库，完全可以这样设计：每个文件夹表示一个年度入学的学生，比如2018级、2019级等等，每年新建一个文件夹。每个文件夹里有几个文件，按照高中部一个文件、初中部一个文件，或是按年级分等等。总之根据实际情况分成少数几个文件，不要做成每个班一个文件，文件太多关联查询会非常困难。然后每个文件里，可以用Json或CSV或XML格式（甚至可以设计一种高效的二进制格式），保存所有学生的信息。另外根据需求，还可以添加科目成绩信息等等，做成新的文件，用学生ID与学生总表对应。在这个系统上，也可以实现查询、修改信息、筛选学生等等各种功能。但它有几个特点：1、程序运行时，需要载入大量信息到内存中——可以接受无论采用哪种数据格式，直接在原始文件上做查询、修改是不现实的。必须用某种库比如Json库、XML库等，将文件加载到内存中，形成一些方便使用的容器。好在学生信息并不是特别多，以现在的硬件水平来说，全部加载到内存也应该可以接受。无论做成列表也好，字典也好，各种查询工作都是基本的容器操作。其实这和大型实时网游，比如魔兽世界、剑网都差不多，在线玩家（强调：是在线玩家）的数据是在内存中的，支持高频次（每秒改15次~30次）修改。2、各种常规操作需要专门写代码——有点麻烦一些常规查询，比如名字和分数的对应，科目和老师的对应，可以实现多建几个字典（哈希表），方便随时查询。一些特殊查询，“生物科目，75~80分有哪些人？”，“数学平时分不及格有哪些人？”，可以写代码遍历查询，做成一个特殊功能。3、数据写回文件——灾难的开始如果正在录入学生数据，刚录了100个，停电或BUG了，内存数据很可能就没了。显然，写回文件才能稳妥保存数据，那何时保存呢？隔30秒一次？5分钟一次？显然，隔的时间越久，数据越不安全；隔的时间越近，磁盘就越繁忙、性能急剧下降。而且请注意，上面的这种简易文件系统不支持增量写入，就算支持增量写入，也几乎不可能支持“插入写入”。就是不支持在中间插入内容、后面的数据自动往后挪。所以几乎所有的写入都是全量更新，把内存数据转化为Json、CSV、XML等全部写一遍文件。系统开发者和维护人员，必须在性能与安全性之间平衡。学校的信息维护工作变得非常刺激，很有挑战性 ：）。解决方案除上面几点以外还有很多具体问题，不再赘述。但以上问题有对应的解决方案：1、为避免加载所有数据到内存中，可以写一个总的数据管理模块，保证内存中只有索引等必要的数据而不是全部。2、为了方便编写各种复杂的查询逻辑，可以设计一套通用的查询语法。这套语法虽然也需要学习，但总比直接写程序要简单得多。3、要彻底解决数据写回文件的问题，必须让文件支持“部分修改”的特性，不能插入一些数据就全写整个文件。每次修改都能妥善保存数据，提供读取、修改、写回的标准流程，尽可能让丢失数据的意外降到最低。总之，只要做到了这些，信息库就能放心的使用了。同时，一个麻雀虽小五脏俱全的数据库也诞生了。 ：）